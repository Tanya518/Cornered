<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORNERED - –ì—Ä–∞</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            font-family: 'Verdana', sans-serif;
            color: #a6f060;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 10px;
        }

        h1 {
            font-size: 2.5em;
            margin: 5px 0;
            text-shadow: 0 0 20px #a6f060;
            letter-spacing: 5px;
        }

        #loading {
            font-size: 1.2em;
            margin: 10px 0;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .info {
            margin: 5px 0;
            padding: 5px;
            font-size: 0.8em;
        }

        #canvas-wrapper {
            flex: 1;
            display: flex;
            align-items: stretch;
            justify-content: stretch;
            width: 100%;
            position: relative;
        }

        #gameCanvas {
            border: 3px solid #a6f060;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(166, 240, 96, 0.5);
            background: #000;
            width: 100%;
            height: 100%;
            object-fit: fill;
        }

        .controls {
            margin: 5px 0;
            font-size: 0.75em;
            color: #e86421;
            flex-wrap: wrap;
            display: flex;
            justify-content: center;
        }

        .controls span {
            display: inline-block;
            margin: 2px 5px;
            padding: 3px 8px;
            background: rgba(232, 100, 33, 0.2);
            border-radius: 5px;
        }

        #score-display {
            font-size: 1.3em;
            margin: 5px 0;
            color: #a6f060;
        }

        #phrase-display {
            font-size: 1.1em;
            margin: 5px 0;
            color: #a6f060;
            min-height: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5em;
                letter-spacing: 2px;
            }
            .controls {
                font-size: 0.65em;
            }
            #score-display {
                font-size: 1.1em;
            }
            #phrase-display {
                font-size: 0.9em;
                min-height: 25px;
                height: 25px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>üéÆ CORNERED</h1>

        <div id="loading">
            ‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—Ä–∏...<br>
            <small>–ó–∞—á–µ–∫–∞–π—Ç–µ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥</small>
        </div>

        <div id="score-display">Score: 0</div>
        <div id="phrase-display"></div>

        <div id="canvas-wrapper" style="display:none;">
            <canvas id="gameCanvas"></canvas>
        </div>

        <div class="info">
            <strong>–ö–µ—Ä—É–≤–∞–Ω–Ω—è:</strong> ‚¨ÜÔ∏è ‚¨áÔ∏è ‚¨ÖÔ∏è ‚û°Ô∏è —Å—Ç—Ä—ñ–ª–∫–∏ –∞–±–æ WASD
        </div>

        <div class="controls">
            <span>üü¢ –¢—Ä–∏–∫—É—Ç–Ω–∏–∫–∏ = +1 –±–∞–ª</span>
            <span>üî¥ –†–æ–º–±–∏ = –∑–±—ñ–ª—å—à–µ–Ω–Ω—è</span>
            <span>üü† –ö–≤–∞–¥—Ä–∞—Ç–∏ = -1 –±–∞–ª</span>
            <span>‚ö™ –ë—ñ–ª—ñ —à–µ—Å—Ç–∏–∫—É—Ç–Ω–∏–∫–∏ = —Å–Ω—ñ–≥</span>
            <span>üü¢ –ó–µ–ª–µ–Ω—ñ —à–µ—Å—Ç–∏–∫—É—Ç–Ω–∏–∫–∏ = +3 –±–∞–ª–∏</span>
        </div>
    </div>

    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

    <script type="py">
import random
import math
from js import document, window, setInterval, clearInterval
from pyodide.ffi import create_proxy

# –û—Ç—Ä–∏–º–∞—Ç–∏ canvas —Ç–∞ context
canvas = document.getElementById("gameCanvas")
ctx = canvas.getContext("2d")

# –î–∏–Ω–∞–º—ñ—á–Ω—ñ —Ä–æ–∑–º—ñ—Ä–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–∫–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–∞
def update_canvas_size():
    global WIDTH, HEIGHT
    wrapper = document.getElementById("canvas-wrapper")
    WIDTH = int(wrapper.clientWidth - 10)
    HEIGHT = int(wrapper.clientHeight - 10)
    canvas.width = WIDTH
    canvas.height = HEIGHT

update_canvas_size()
WIDTH = canvas.width
HEIGHT = canvas.height

# –ö–æ–ª—å–æ—Ä–∏
COLOR_GREEN = "#a6f060"
COLOR_BLACK = "#000000"
COLOR_ORANGE = "#e86421"
COLOR_RED = "#781f1f"
COLOR_DARK_GRAY = "#151515"
COLOR_WHITE = "#ffffff"
COLOR_SNOWFLAKE = "#f4efe5"
COLOR_LIGHT_GREEN = "#9ad370"

# –§—Ä–∞–∑–∏
CURSE_PHRASES = [
    "–û–π –ª–∏—à–µ–Ω—å–∫–æ!",
    "–¢–∞ —â–æ –∑–∞ —Ö–∞–ª–µ–ø–∞!",
    "–ê–Ω—É –∂ –±–æ!",
    "–û—Ç —Ç–æ–±—ñ –π –Ω–∞!",
    "–¢–∞ –π–æ–π-–π–æ–π-–π–æ–π!",
    "–ö–∞–ø–µ—Ü—å –ø–æ–≤–Ω–∏–π!",
    "–ú–∞–º–æ —Ä—ñ–¥–Ω–∞!",
    "–¢–∞ –Ω—É —à–æ –∑–∞ –¥—î–ª–æ–≤!",
    "–•—Ä–µ–Ω–∞—Å–µ!",
    "–ü–∏–ø–µ—Ü—å!",
]

SARCASTIC_PHRASES = [
    "–ù—É –∑–≤—ñ—Å–Ω–æ, —á–æ–≥–æ —â–µ —á–µ–∫–∞—Ç–∏!",
    "–Ø–∫–∞—Å—å –º–∞–≥—ñ—è –ø—Ä–æ—Å—Ç–æ!",
    "–û, —è–∫ –Ω–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–æ!",
    "–ù—É –∫–ª–∞—Å–Ω–æ –∂!",
    "–û—Ç —Ü–µ –ø–æ–≤–æ—Ä–æ—Ç!",
    "–ê—Ö–∞, –Ω—É-–Ω—É!",
    "–ú–æ–∂–µ —â–µ —Ä–∞–∑–æ–∫?",
    "–ß—É–¥–æ–≤–æ, –Ω–µ–º–∞ —Å–ª—ñ–≤!",
    "–ë—Ä–∞–≤–æ, –ø—Ä–æ—Å—Ç–æ –±—Ä–∞–≤–æ!",
    "–ù—É —ñ –¥–∏–≤–∞!",
]

HAPPY_PHRASES = [
    "–ù—è–º-–Ω—è–º!",
    "–ú–º–º, —Å–º–∞–∫–æ—Ç–∞!",
    "–û—Ç —Ü–µ —Ç–∞–∫!",
    "–ö–∞–π—Ñ!",
    "–•—Ä—É–º-—Ö—Ä—É–º!",
    "–û—Ç–æ –¥–æ–±—Ä–µ!",
    "–ö—Ä–∞—Å–æ—Ç–∞!",
    "–û—Å—å —Ü–µ –¥—ñ–ª–æ!",
    "–°–º–∞—á–Ω–æ!",
    "–ß—É–¥–æ–≤–æ!",
]

# –ì—Ä–∞–≤–µ—Ü—å
class Player:
    def __init__(self):
        self.x = WIDTH // 2
        self.y = HEIGHT // 2
        self.width = 60
        self.height = 60
        self.color = COLOR_GREEN
        self.speed = 6
        self.knockback_vx = 0
        self.knockback_vy = 0
        self.rotation = 0
        self.rotation_speed = 0
        self.is_enlarged = False

    def draw(self):
        ctx.save()
        ctx.translate(self.x + self.width/2, self.y + self.height/2)
        ctx.rotate(self.rotation * math.pi / 180)
        ctx.fillStyle = self.color
        ctx.fillRect(-self.width/2, -self.height/2, self.width, self.height)
        # –û–∫–æ
        ctx.fillStyle = COLOR_BLACK
        ctx.beginPath()
        ctx.arc(self.width/2 - 12, -self.height/2 + 12, 5, 0, 2 * math.pi)
        ctx.fill()
        ctx.restore()

    def update(self, keys, wind_x_force, wind_y_force):
        # –í—ñ–¥—à—Ç–æ–≤—Ö—É–≤–∞–Ω–Ω—è
        if abs(self.knockback_vx) > 0.5 or abs(self.knockback_vy) > 0.5:
            new_x = self.x + self.knockback_vx
            new_y = self.y + self.knockback_vy

            if new_x < 0:
                self.x = 0
                self.knockback_vx = -self.knockback_vx * 0.6
            elif new_x > WIDTH - self.width:
                self.x = WIDTH - self.width
                self.knockback_vx = -self.knockback_vx * 0.6
            else:
                self.x = new_x

            if new_y < 0:
                self.y = 0
                self.knockback_vy = -self.knockback_vy * 0.6
            elif new_y > HEIGHT - self.height:
                self.y = HEIGHT - self.height
                self.knockback_vy = -self.knockback_vy * 0.6
            else:
                self.y = new_y

            self.knockback_vx *= 0.95
            self.knockback_vy *= 0.95
        else:
            # –ö–µ—Ä—É–≤–∞–Ω–Ω—è
            move_x = 0
            move_y = 0

            if "ArrowDown" in keys or "s" in keys or "S" in keys:
                move_y += self.speed
            if "ArrowUp" in keys or "w" in keys or "W" in keys:
                move_y -= self.speed
            if "ArrowRight" in keys or "d" in keys or "D" in keys:
                move_x += self.speed
            if "ArrowLeft" in keys or "a" in keys or "A" in keys:
                move_x -= self.speed

            # –î–æ–¥–∞—î–º–æ —Å–∏–ª—É –≤—ñ—Ç—Ä—É
            move_x += wind_x_force
            move_y += wind_y_force

            new_x = self.x + move_x
            new_y = self.y + move_y

            if 0 <= new_x <= WIDTH - self.width:
                self.x = new_x
            if 0 <= new_y <= HEIGHT - self.height:
                self.y = new_y

        # –û–±–µ—Ä—Ç–∞–Ω–Ω—è
        if abs(self.rotation_speed) > 0.05:
            self.rotation += self.rotation_speed
            self.rotation_speed *= 0.98
        else:
            self.rotation_speed = 0

    def collides_with(self, obj):
        return (self.x < obj["x"] + obj["width"] and
                self.x + self.width > obj["x"] and
                self.y < obj["y"] + obj["height"] and
                self.y + self.height > obj["y"])

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤
def create_enemy():
    return {
        "type": "enemy",
        "x": WIDTH,
        "y": random.randint(50, HEIGHT - 50),
        "width": 30,
        "height": 30,
        "vx": random.randint(-6, -1),
        "vy": 0,
        "color": COLOR_ORANGE
    }

def create_bonus():
    return {
        "type": "bonus",
        "x": random.randint(50, WIDTH - 50),
        "y": 0,
        "width": 40,
        "height": 40,
        "vx": 0,
        "vy": random.randint(2, 6),
        "color": f"#{random.randint(0, 255):02x}{random.randint(0, 255):02x}{random.randint(0, 255):02x}"
    }

def create_diamond():
    return {
        "type": "diamond",
        "x": WIDTH,
        "y": random.randint(50, HEIGHT - 50),
        "width": 40,
        "height": 40,
        "vx": random.randint(-6, -1),
        "vy": 0,
        "color": COLOR_RED
    }

def create_snow_hex():
    return {
        "type": "snow_hex",
        "x": random.randint(50, WIDTH - 50),
        "y": 0,
        "width": 30,
        "height": 30,
        "vx": 0,
        "vy": 3,
        "color": COLOR_WHITE,
        "vibration": random.uniform(0, 6.28),
        "vib_dir": random.uniform(-1, 1)
    }

def create_green_hex():
    return {
        "type": "green_hex",
        "x": random.randint(50, WIDTH - 50),
        "y": 0,
        "width": 30,
        "height": 30,
        "vx": 0,
        "vy": 3,
        "color": COLOR_LIGHT_GREEN,
        "vibration": random.uniform(0, 6.28),
        "vib_dir": random.uniform(-1, 1)
    }

# –ú–∞–ª—é–≤–∞–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤
def draw_object(obj):
    obj_type = obj["type"]

    if obj_type == "enemy":
        ctx.fillStyle = obj["color"]
        ctx.fillRect(obj["x"], obj["y"], obj["width"], obj["height"])

    elif obj_type == "bonus":
        ctx.fillStyle = obj["color"]
        ctx.beginPath()
        ctx.moveTo(obj["x"] + 20, obj["y"])
        ctx.lineTo(obj["x"], obj["y"] + 40)
        ctx.lineTo(obj["x"] + 40, obj["y"] + 40)
        ctx.closePath()
        ctx.fill()

    elif obj_type == "diamond":
        ctx.fillStyle = obj["color"]
        ctx.beginPath()
        cx = obj["x"] + 20
        cy = obj["y"] + 20
        ctx.moveTo(cx, cy - 20)
        ctx.lineTo(cx + 20, cy)
        ctx.lineTo(cx, cy + 20)
        ctx.lineTo(cx - 20, cy)
        ctx.closePath()
        ctx.fill()

    elif obj_type in ["snow_hex", "green_hex"]:
        # –í—ñ–±—Ä–∞—Ü—ñ—è
        obj["vibration"] += 0.25
        vib_x = 3.5 * math.cos(obj["vibration"]) * obj["vib_dir"]

        ctx.fillStyle = obj["color"]
        ctx.beginPath()
        cx = obj["x"] + 15 + vib_x
        cy = obj["y"] + 15
        radius = 14
        for i in range(6):
            angle = i * 60 * math.pi / 180
            x = cx + radius * math.cos(angle)
            y = cy + radius * math.sin(angle)
            if i == 0:
                ctx.moveTo(x, y)
            else:
                ctx.lineTo(x, y)
        ctx.closePath()
        ctx.fill()

# –Ü–≥—Ä–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ
player = Player()
enemies = []
bonuses = []
diamonds = []
snow_hexes = []
green_hexes = []
snowflakes = []

score = 0
best_score = 0
current_phrase = ""
phrase_timer = 0
is_snowing = False
wind_x = 0
wind_y = 0

keys_pressed = set()
enemy_collision_occurred = False
diamond_collision_occurred = False
snow_collision_occurred = False

enemy_timer_val = 1200
bonus_timer_val = 1500
diamond_timer_val = 4500

# –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI
def update_ui():
    score_display = document.getElementById("score-display")
    phrase_display = document.getElementById("phrase-display")

    score_color = COLOR_GREEN if score >= 0 else COLOR_ORANGE
    score_display.innerHTML = f'<span style="color:{score_color}">Score: {score}</span>'

    if phrase_timer > 0:
        phrase_display.innerHTML = current_phrase
    else:
        phrase_display.innerHTML = "&nbsp;"

# –û—Å–Ω–æ–≤–Ω–∏–π —Ü–∏–∫–ª –≥—Ä–∏
def game_loop():
    global score, current_phrase, phrase_timer, is_snowing, wind_x, wind_y
    global enemy_collision_occurred, diamond_collision_occurred, snow_collision_occurred

    # –û—á–∏—Å—Ç–∏—Ç–∏ canvas
    ctx.fillStyle = COLOR_BLACK
    ctx.fillRect(0, 0, WIDTH, HEIGHT)

    # –°–Ω—ñ–≥
    if is_snowing:
        if random.random() < 0.1 and len(snowflakes) < 50:
            snowflakes.append({
                "x": random.randint(0, WIDTH),
                "y": 0,
                "size": random.randint(4, 8),
                "rotation": random.uniform(0, 360),
                "fall_speed": random.uniform(1, 4),
                "rotation_speed": random.uniform(-0.5, 0.5)
            })

        for flake in snowflakes[:]:
            flake["x"] += wind_x
            flake["y"] += flake["fall_speed"]
            flake["rotation"] += flake["rotation_speed"]

            if flake["y"] < HEIGHT and 0 < flake["x"] < WIDTH:
                # –ú–∞–ª—é—î–º–æ –±–∞–≥–∞—Ç–æ–∫—É—Ç–Ω–∏–∫ –∑–∞–º—ñ—Å—Ç—å –∫–æ–ª–∞
                ctx.save()
                ctx.translate(flake["x"], flake["y"])
                ctx.rotate(flake["rotation"] * math.pi / 180)
                ctx.fillStyle = COLOR_SNOWFLAKE
                ctx.beginPath()
                num_points = random.randint(5, 7)
                radius = flake["size"]
                for i in range(num_points):
                    angle = (i / num_points) * 2 * math.pi
                    r = radius * random.uniform(0.5, 1.0)
                    x = r * math.cos(angle)
                    y = r * math.sin(angle)
                    if i == 0:
                        ctx.moveTo(x, y)
                    else:
                        ctx.lineTo(x, y)
                ctx.closePath()
                ctx.fill()
                ctx.restore()
            else:
                snowflakes.remove(flake)

    # –û–Ω–æ–≤–∏—Ç–∏ –≥—Ä–∞–≤—Ü—è (–ø–µ—Ä–µ–¥–∞—î–º–æ —Å–∏–ª—É –≤—ñ—Ç—Ä—É)
    player.update(keys_pressed, wind_x, wind_y)

    # –û–Ω–æ–≤–∏—Ç–∏ –≤–æ—Ä–æ–≥–∏
    for enemy in enemies[:]:
        enemy["x"] += enemy["vx"]
        draw_object(enemy)

        if player.collides_with(enemy) and not enemy_collision_occurred:
            current_phrase = random.choice(SARCASTIC_PHRASES if random.random() < 0.5 else CURSE_PHRASES)
            phrase_timer = 120
            score -= 1
            enemy_collision_occurred = True

            # –í—ñ–¥—à—Ç–æ–≤—Ö—É–≤–∞–Ω–Ω—è
            dx = player.x + player.width/2 - (enemy["x"] + enemy["width"]/2)
            dy = player.y + player.height/2 - (enemy["y"] + enemy["height"]/2)
            dist = math.sqrt(dx*dx + dy*dy) or 1
            dx /= dist
            dy /= dist

            force = 10 + abs(enemy["vx"]) * 2
            player.knockback_vx = dx * force
            player.knockback_vy = dy * force
            player.rotation_speed = random.uniform(-15, 15)

            if score < 0:
                game_over()
                return

        if enemy["x"] < -enemy["width"]:
            enemies.remove(enemy)

    if not any(player.collides_with(e) for e in enemies):
        enemy_collision_occurred = False

    # –û–Ω–æ–≤–∏—Ç–∏ –±–æ–Ω—É—Å–∏
    for bonus in bonuses[:]:
        bonus["y"] += bonus["vy"]
        draw_object(bonus)

        if player.collides_with(bonus):
            score += 1
            current_phrase = random.choice(HAPPY_PHRASES)
            phrase_timer = 120

            if player.is_enlarged:
                player.width = 60
                player.height = 60
                player.is_enlarged = False

            player.color = bonus["color"]
            bonuses.remove(bonus)

        if bonus["y"] > HEIGHT:
            bonuses.remove(bonus)

    # –û–Ω–æ–≤–∏—Ç–∏ –∞–ª–º–∞–∑–∏
    for diamond in diamonds[:]:
        diamond["x"] += diamond["vx"]
        draw_object(diamond)

        if player.collides_with(diamond) and not diamond_collision_occurred:
            current_phrase = random.choice(SARCASTIC_PHRASES)
            phrase_timer = 120
            diamond_collision_occurred = True
            player.is_enlarged = True
            player.width = 90
            player.height = 90
            player.color = COLOR_DARK_GRAY

            # –í—ñ–¥—à—Ç–æ–≤—Ö—É–≤–∞–Ω–Ω—è
            dx = player.x + player.width/2 - (diamond["x"] + diamond["width"]/2)
            dy = player.y + player.height/2 - (diamond["y"] + diamond["height"]/2)
            dist = math.sqrt(dx*dx + dy*dy) or 1
            dx /= dist
            dy /= dist

            force = 10 + abs(diamond["vx"]) * 2
            player.knockback_vx = dx * force
            player.knockback_vy = dy * force
            player.rotation_speed = random.uniform(-15, 15)

        if diamond["x"] < -diamond["width"]:
            diamonds.remove(diamond)

    if not any(player.collides_with(d) for d in diamonds):
        diamond_collision_occurred = False

    # –û–Ω–æ–≤–∏—Ç–∏ –±—ñ–ª—ñ —à–µ—Å—Ç–∏–∫—É—Ç–Ω–∏–∫–∏
    for snow_hex in snow_hexes[:]:
        snow_hex["y"] += snow_hex["vy"]
        draw_object(snow_hex)

        if player.collides_with(snow_hex) and not snow_collision_occurred:
            current_phrase = random.choice(CURSE_PHRASES)
            phrase_timer = 120
            snow_collision_occurred = True
            is_snowing = True
            wind_x = random.uniform(-5, 5)
            wind_y = random.uniform(-2, 2)

        if snow_hex["y"] > HEIGHT:
            snow_hexes.remove(snow_hex)

    if not any(player.collides_with(s) for s in snow_hexes):
        snow_collision_occurred = False

    # –û–Ω–æ–≤–∏—Ç–∏ –∑–µ–ª–µ–Ω—ñ —à–µ—Å—Ç–∏–∫—É—Ç–Ω–∏–∫–∏
    for green_hex in green_hexes[:]:
        green_hex["y"] += green_hex["vy"]
        draw_object(green_hex)

        if player.collides_with(green_hex):
            current_phrase = random.choice(HAPPY_PHRASES)
            phrase_timer = 120
            score += 3
            is_snowing = False
            wind_x = 0
            wind_y = 0
            snowflakes.clear()
            green_hexes.remove(green_hex)

        if green_hex["y"] > HEIGHT:
            green_hexes.remove(green_hex)

    # –ù–∞–º–∞–ª—é–≤–∞—Ç–∏ –≥—Ä–∞–≤—Ü—è
    player.draw()

    # –ó–º–µ–Ω—à–∏—Ç–∏ —Ç–∞–π–º–µ—Ä —Ñ—Ä–∞–∑–∏
    if phrase_timer > 0:
        phrase_timer -= 1

    # –û–Ω–æ–≤–∏—Ç–∏ UI
    update_ui()

# –¢–∞–π–º–µ—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤
def spawn_enemy():
    enemies.append(create_enemy())

def spawn_bonus():
    bonuses.append(create_bonus())

def spawn_diamond():
    diamonds.append(create_diamond())

def spawn_snow_hex():
    snow_hexes.append(create_snow_hex())

def spawn_green_hex():
    green_hexes.append(create_green_hex())

def change_difficulty():
    global enemy_timer_val, bonus_timer_val, diamond_timer_val
    if enemy_timer_val > 400:
        enemy_timer_val -= 50
    if bonus_timer_val > 800:
        bonus_timer_val -= 50
    if diamond_timer_val > 1500:
        diamond_timer_val -= 100

# Game Over
def game_over():
    global best_score, game_interval
    if score > best_score:
        best_score = score

    clearInterval(game_interval)
    ctx.fillStyle = COLOR_BLACK
    ctx.fillRect(0, 0, WIDTH, HEIGHT)

    ctx.fillStyle = COLOR_ORANGE
    ctx.font = "60px Verdana"
    ctx.textAlign = "center"
    ctx.fillText("GAME OVER", WIDTH/2, HEIGHT/2 - 50)

    ctx.fillStyle = COLOR_GREEN
    ctx.font = "30px Verdana"
    ctx.fillText(f"Your Score: {score}", WIDTH/2, HEIGHT/2 + 20)
    ctx.fillText(f"Best Score: {best_score}", WIDTH/2, HEIGHT/2 + 70)
    ctx.fillText("Reload page to restart", WIDTH/2, HEIGHT/2 + 140)

# –û–±—Ä–æ–±–∫–∞ –∫–ª–∞–≤—ñ—à
def on_keydown(event):
    keys_pressed.add(event.key)
    event.preventDefault()

def on_keyup(event):
    if event.key in keys_pressed:
        keys_pressed.remove(event.key)
    event.preventDefault()

# –û–±—Ä–æ–±–Ω–∏–∫ –∑–º—ñ–Ω–∏ —Ä–æ–∑–º—ñ—Ä—É –≤—ñ–∫–Ω–∞
def on_resize(event):
    update_canvas_size()

# –°—Ç–∞—Ä—Ç –≥—Ä–∏
def start_game():
    global game_interval

    # –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    loading = document.getElementById("loading")
    loading.style.display = "none"

    # –ü–æ–∫–∞–∑–∞—Ç–∏ canvas —Ç–∞ UI
    document.getElementById("canvas-wrapper").style.display = "block"

    # –û–Ω–æ–≤–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä canvas –ø—ñ—Å–ª—è –ø–æ–∫–∞–∑—É
    update_canvas_size()

    # –î–æ–¥–∞—Ç–∏ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –∫–ª–∞–≤—ñ—à
    keydown_proxy = create_proxy(on_keydown)
    keyup_proxy = create_proxy(on_keyup)
    document.addEventListener("keydown", keydown_proxy)
    document.addEventListener("keyup", keyup_proxy)

    # –î–æ–¥–∞—Ç–∏ –æ–±—Ä–æ–±–Ω–∏–∫ resize
    resize_proxy = create_proxy(on_resize)
    window.addEventListener("resize", resize_proxy)

    # –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–∞–π–º–µ—Ä–∏
    setInterval(create_proxy(spawn_enemy), enemy_timer_val)
    setInterval(create_proxy(spawn_bonus), bonus_timer_val)
    setInterval(create_proxy(spawn_diamond), diamond_timer_val)
    setInterval(create_proxy(spawn_snow_hex), 2500)
    setInterval(create_proxy(spawn_green_hex), 2500)
    setInterval(create_proxy(change_difficulty), 5000)

    # –û—Å–Ω–æ–≤–Ω–∏–π —Ü–∏–∫–ª (60 FPS)
    game_interval = setInterval(create_proxy(game_loop), 1000/60)

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≥—Ä—É
start_game()
    </script>
</body>
</html>
